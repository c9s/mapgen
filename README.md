
# mapgen

`mapgen` is a Go code generation tool for creating utility functions and mappings for Go types. It automates the creation of maps, groupings, and utility functions for custom types defined in your Go code.

## Features

- Automatically generate a map of constants for a specified type.
- Group constants based on `@group` annotations in comments.
- Generate utility functions:
  - Convert a slice of custom types to a slice of strings or integers.
  - Extract keys from a `map[Type]struct{}`.
  - Validate if a value exists in the generated map or specific groups.
- Supports group-specific `Keys` and `Validate` functions.

## Installation

Install `mapgen` using `go install`:

```bash
go install github.com/c9s/mapgen@latest
```

Ensure that your `GOPATH` is properly configured and the `go/bin` directory is in your `PATH`.

## Usage

Run `mapgen` in a Go package directory to generate code for a specific type.

### Command-line options

- `-type`: The name of the type for which the constants and utilities should be generated (required).
- `-output`: (Optional) The output file name. Defaults to `<type>map.go`.
- `-stdout`: Output the generated code to stdout instead of writing to a file.

### Example

#### Using `mapgen` Manually

Given a type `PrivateChannel` with associated constants:

```go
type PrivateChannel string

const (
    // @group orders
    PrivateChannelOrder PrivateChannel = "order"
    PrivateChannelTrade PrivateChannel = "trade"

    // @group margin
    PrivateChannelMarginOrder PrivateChannel = "margin_order"
)
```

Run `mapgen` to generate utility functions and mappings:

```bash
mapgen -type PrivateChannel
```

The generated file `privatechannelmap.go` will include:

```go
// Code generated by go:generate; DO NOT EDIT.
package main

var AllPrivateChannel = map[PrivateChannel]struct{}{
    PrivateChannelOrder: {},
    PrivateChannelTrade: {},
    PrivateChannelMarginOrder: {},
}

var AllOrdersPrivateChannel = map[PrivateChannel]struct{}{
    PrivateChannelOrder: {},
    PrivateChannelTrade: {},
}

// AllOrdersPrivateChannelKeys converts the orders group map of PrivateChannel to a slice of PrivateChannel
func AllOrdersPrivateChannelKeys() []PrivateChannel {
    keys := make([]PrivateChannel, 0, len(AllOrdersPrivateChannel))
    for k := range AllOrdersPrivateChannel {
        keys = append(keys, k)
    }
    return keys
}

// ValidateOrdersPrivateChannel validates if a value belongs to the orders group of PrivateChannel
func ValidateOrdersPrivateChannel(ch PrivateChannel) bool {
    _, ok := AllOrdersPrivateChannel[ch]
    return ok
}

var AllMarginPrivateChannel = map[PrivateChannel]struct{}{
    PrivateChannelMarginOrder: {},
}

// AllMarginPrivateChannelKeys converts the margin group map of PrivateChannel to a slice of PrivateChannel
func AllMarginPrivateChannelKeys() []PrivateChannel {
    keys := make([]PrivateChannel, 0, len(AllMarginPrivateChannel))
    for k := range AllMarginPrivateChannel {
        keys = append(keys, k)
    }
    return keys
}

// ValidateMarginPrivateChannel validates if a value belongs to the margin group of PrivateChannel
func ValidateMarginPrivateChannel(ch PrivateChannel) bool {
    _, ok := AllMarginPrivateChannel[ch]
    return ok
}

var AllPrivateChannelSlice = []PrivateChannel{
    PrivateChannelOrder,
    PrivateChannelTrade,
    PrivateChannelMarginOrder,
}

// PrivateChannelStrings converts a slice of PrivateChannel to a slice of string
func PrivateChannelStrings(slice []PrivateChannel) (out []string) {
    for _, el := range slice {
        out = append(out, string(el))
    }
    return out
}

// PrivateChannelKeys converts a map of PrivateChannel to a slice of PrivateChannel
func PrivateChannelKeys(values map[PrivateChannel]struct{}) (slice []PrivateChannel) {
    for k := range values {
        slice = append(slice, k)
    }
    return slice
}

// ValidatePrivateChannel validates a value of type PrivateChannel
func ValidatePrivateChannel(ch PrivateChannel) bool {
    _, ok := AllPrivateChannel[ch]
    return ok
}
```

#### Using `mapgen` with `go:generate`

To integrate `mapgen` with your build process, use the `go:generate` directive. Add the following comment above the type definition file:

```go
//go:generate mapgen -type PrivateChannel
```

Then, run the following command in your project directory:

```bash
go generate
```

This will automatically invoke `mapgen` and generate the corresponding utility code for `PrivateChannel`. The generated file will follow the naming convention `<type>map.go`, e.g., `privatechannelmap.go`.

## Contributing

Contributions are welcome! Feel free to open issues or submit pull requests on [GitHub](https://github.com/c9s/mapgen).

## License

`mapgen` is licensed under the MIT License.
